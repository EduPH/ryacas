---
title: "Towards a JSS-like paper on ryacas"
author: "Mikkel Meyer Andersen and Søren Højsgaard"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Towards a JSS-like paper on ryacas}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(Ryacas)
library(Matrix)
```

\def\ryacas{{\bf Ryacas}}
\def\yacas{{\bf yacas}}
\def\R{{\bf R}}
\def\var{{Var}}
\def\inv{^{-1}}
\def\transp{^\top}

%%
%% Easy matrices:
%%
\newcommand{\matrxr}[2][rrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrr]
{\left(
    \begin{array}{#1}
      #2 \\
    \end{array}
  \right)}
% Usage: $\matrxr{-1&-2\\3&4}$

\newcommand{\matrxc}[2][cccccccccccccccccccccccccccccccccccc]
{\left(
    \begin{array}{#1}
      #2 \\
    \end{array}
  \right)}
% Usage: $\matrxl{-1&-2\\3&4}$

\newcommand{\matrxl}[2][lllllllllllllllllllllllllllllllllllll]
{\left(
    \begin{array}{#1}
      #2 \\
    \end{array}
  \right)}
% Usage: $\matrxl{-1&-2\\3&4}$



## Introduction

\ryacas\ is an \R\ package, \cite{R}, that provides an interface from \R\ to the open source computer algebra system \yacas, \cite{yacas} ("yacas" is short for "yet another computer algebra system"). \yacas\ is nowhere as powerful as the larger commercial computer algebra systems (CAS), but from a statisticians perspective, \yacas\ does provide convenient tools. Some of these will be illustrated here.


## A first example with yacas

Solve an equation; compute a derivative; find a limit... ???

## Naive Bayes model

Consider this model: 
\begin{align}
  \label{eq:1}
  x_0 &= \mu_0 + e_0 \\
  x_i &= \mu_i + a x_0 + e_i, \quad i=1, \dots, M
\end{align}

All terms $e_0, \dots, e_M$ are independent and $N(0,v^2)$
distributed. The model is illustrated by the directed acyclic graph
(DAG) in Fig.~\ref{nib01}. In the following, we shall work with $M=3$.
Let $e=(e_0, \dots, e_3)$, $\mu=(\mu_0, \dots, \mu_3)$ and
$x=(x_0, \dots x_3)$. It is a standard result that $x$ will be
multivariate normally distributed, $x\sim N_{4}(\mu, V)$. We shall use
\ryacas\ for computing (symbolically) the structure of $V$ and in
particular of $K=V\inv$, the so--called concentration matrix.


```{r, fig.height=4}
library(igraph)
plot(make_graph(paste0("x_", as.character(c(0, 1, 0, 2, 0, 3, 0, 4)))), vertex.size=30)
```

Isolating error terms gives that
\begin{displaymath}
  \matrxc{e_0\\ e_1\\ e_2 \\ e_3} =
  \matrxc{1 & 0 & 0 & 0 \\
    -a & 1 & 0 & 0 \\
    -a & 0 & 1 & 0 \\
    -a & 0 & 0 & 1
  }
  \matrxc{x_0 - \mu_0 \\ x_1 - \mu_1 \\ x_2 - \mu_2 \\ x_3 - \mu_3}
\end{displaymath}
or 
$$
 e = L_1 (x-\mu)
$$
where $L_1$ is lower triangular. We get directly that
$v^2 I = L_1 \var(x) L_1\transp$. Hence the covariance and the concentration matrices become
\begin{align}
V&=v^2 L_1\inv (L_1\inv)\transp   \\
K&=v^{-2} L_1\transp L_1
\end{align}


There is a small detail to keep in mind\footnote{Where to put this?}: There objects exist on the \R--side and on the \yacas--side. We shall use the convention here that object names in \yacas\ are post--fixed with an underscore while objects in \R\ are not. \footnote{Perhaps underscore-y?}. If we assume $v^2=1$ expressions become simpler:

```{r}
L1 <- diag(4)
L1[2:4, 1] <- "-a"
L1_ <- as.Sym(L1)
L1_
```

```{r}
L1inv_ <- Inverse(L1_)
L1inv_
K1_ <- Transpose(L1_) * L1_
V1_ <- L1inv * Transpose(L1inv_)
```

```{r, results="asis"}
cat(
  "\\begin{align} 
    K_1 &= ", TeXForm(K1_), " \\\\ 
   V_1 &= ", TeXForm(V1_), " 
  \\end{align}", sep = "")
```

The important structure of the model is revealed in the concentration
matrix $K$: When $K_{ij}=0$ is equivalent to $x_i$ and $x_j$ being
conditionally independent given all other variables. [[Need reference]]

[[Can we get K back as a character matrix???]]
































<!-- % has the form -->
<!-- % ```{r} -->
<!-- % L1chr <- diag(4) -->
<!-- % L1chr[2:4, 1] <- "-a" -->
<!-- % L1 <- as.Sym(L1chr) -->
<!-- % L1 -->
<!-- % ``` -->

<!-- % If error terms have variance $1$ then $\mathbf{Var}(e)=L \mathbf{Var}(x) L'$ so the covariance matrix is $V1=\mathbf{Var}(x) = L^- (L^-)'$ while the concentration matrix (the inverse covariances matrix) is $K=L' L$. -->

<!-- % ```{r} -->
<!-- % L1inv <- Simplify(Inverse(L1)) -->
<!-- % K1 <- Simplify(Transpose(L1) * L1) -->
<!-- % V1 <- Simplify(L1inv * Transpose(L1inv)) -->
<!-- % ``` -->

<!-- % ```{r, results="asis"} -->
<!-- % cat( -->
<!-- %   "\\begin{align}  -->
<!-- %     K_1 &= ", TeXForm(K1), " \\\\  -->
<!-- %    V_1 &= ", TeXForm(V1), "  -->
<!-- %   \\end{align}", sep = "") -->
<!-- % ``` -->

<!-- % Slightly more elaborate: -->

<!-- % ```{r} -->
<!-- % L2chr <- diag(4) -->
<!-- % L2chr[2:4, 1] <- c("-a1", "-a2", "-a3") -->
<!-- % L2 <- as.Sym(L2chr) -->
<!-- % L2 -->
<!-- % Vechr <- diag(4) -->
<!-- % Vechr[cbind(1:4, 1:4)] <- c("w1", "w2", "w2", "w2") -->
<!-- % Ve <- as.Sym(Vechr) -->
<!-- % Ve -->
<!-- % ``` -->

<!-- % ```{r} -->
<!-- % L2inv <- Simplify(Inverse(L2)) -->
<!-- % K2 <- Simplify(Transpose(L2) * Inverse(Ve) * L2) -->
<!-- % V2 <- Simplify(L2inv * Ve * Transpose(L2inv)) -->
<!-- % ``` -->

<!-- % ```{r, results="asis"} -->
<!-- % cat( -->
<!-- %   "\\begin{align}  -->
<!-- %     K_2 &= ", TeXForm(K2), " \\\\  -->
<!-- %    V_2 &= ", TeXForm(V2), "  -->
<!-- %   \\end{align}", sep = "") -->
<!-- % ``` -->



